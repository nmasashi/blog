{% if page.layout == "post" %}
<div id="toc-container">
    <ul id="toc-list" style="overflow-y: auto;"></ul>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var tocList = document.getElementById("toc-list");
        var headers = document.querySelectorAll("h2, h3"); // h2, h3, h4をターゲットに
        
        // 動的に最大高さを設定
        function setTocMaxHeight() {
            var viewportHeight = window.innerHeight;
            var maxHeight = Math.max(300, viewportHeight * 0.8); // 最小300px、画面の80%
            tocList.style.maxHeight = maxHeight + "px";
        }
        
        setTocMaxHeight();
        window.addEventListener("resize", setTocMaxHeight);

        var currentH2Item = null;

        headers.forEach(function (header) {
            var link = document.createElement("a");
            link.href = "#" + header.id;
            link.textContent = header.textContent;

            var listItem = document.createElement("li");
            listItem.appendChild(link);

            if (header.tagName === "H2") {
                // H2の場合、メインリストに追加
                tocList.appendChild(listItem);
                currentH2Item = listItem;
            } else if (header.tagName === "H3" && currentH2Item) {
                // H3の場合、現在のH2のサブリストに追加
                var subList = currentH2Item.querySelector("ul");
                if (!subList) {
                    subList = document.createElement("ul");
                    currentH2Item.appendChild(subList);
                }
                subList.appendChild(listItem);
            }
        });
    });
</script>
{% endif %}