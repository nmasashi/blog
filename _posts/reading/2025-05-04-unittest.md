---
layout: post
title: "単体テストの考え方/使い方"
date: 2025-06-04
categories: reading
---

# 第 1 章 なぜ、単体テストを行うのか

- 単体テストをすることでソフトウェア開発プロジェクトを持続可能にするため
  → 持続可能とはソースの変更が会った際に、退行した機能がないか検出できているかが大きい

テストの品質が悪い場合はテストなしと同じようにプロジェクトは停滞する可能性がある。
単体テストがどのように、このプロジェクトを助けるのかの理解をしていないと品質が低いテストになるリスクが大きくなる。

テストスイート：目的や対象ごとにテスト・ケースを集めたもの

テストの網羅率(coverage)はテスト・スイートの質の良さを示すことができるものではない（悪さを示すことはできる）。

コード網羅率ではテストで実行された行数の割合が算出される。しかし、三項演算子などで一行で二つの条件分岐があるようなコードは想定している網羅率にならないことがある。
分岐網羅率を図ることで対応することはできる。

網羅率が高くてもテストスイートの質がいいとは言えない理由

- ただその行を通っただけで何かを確かめた（テスト）したとは限らない
- ライブラリを使用した場合、ライブラリ内のコードは網羅率の計算には入らない

網羅率は目標にするのではなく、テストが十分に実施されていない指標にするべき

テストスイートの品質をあげるには、結局のところテストケースをひとつづつ評価していくしかない。

テストの実施は開発サイクルの中に含まれる必要がある

システムの重要なビジネスロジックに対するテストに時間を費やすべき。それ以外の部分は簡易なものか間接的なものでも OK

単体テストで最小限の保守コストで最大限の効果を生み出すには

- 価値あるテストケースを認識できること
- 価値あるテストケースを作成できること

## 第 2 章 単体テストとは何か？

単体テストの性質
- 自動化されている
- 「単体 (unit)」と呼ばれる少量のコードを検証する
- 実行時間が短い
- 隔離された状態で実行される

ロンドン学派（モック主義者）
- テスト対象に依存するクラスはテスト・ダブルに置き換える
- 一度に1つのクラスしか検査しない
- テスト失敗時に原因クラスがすぐわかる
- クラス間の依存が多く複雑な場合に有効
- テストに必要な準備を減らせる
- テストケースがシンプルになる

古典学派（デトロイト派）
- DBなどのシステム外の依存（ = 共有依存）はテスト・ダブルに置き換える
- 複数のテストを同時・順番を入れかえてもよい
- 確認できる範囲が広い


テスト・ダブル：モックと同じような意味で使用されているが厳密には違う。モックはテスト・ダブルの一種

依存の種類
- 依存
  - 共有依存：DBとかファイルとか
  - プライベート依存
    - 可変依存：他クラスなど
    - 不変依存：値オブジェクト（定数など）

ロンドン学派と古典学派の特徴
||ロンドン学派|古典学派|
|---|---|---|
|隔離対象|単体|テスト・ケース|
|単体の意味|1つのクラス|1つの機能|
|テスト・ダブル置き換え対象|共有依存、可変依存|共有依存|

__細かな粒度による検証__

- ロンドン学派のテスト単位では細かすぎて、なんの検証か不明になることがある。特に非開発者には何のテストか不明になりがち
- 古典学派はテスト対象のが広いため、どのようなストーリーなのかがわかりやすい

__複雑な依存関係を持つ者に対する単体テスト__


